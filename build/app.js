!function(){"use strict";let e=44100,t=(t=1,s=.05,n=220,o=0,a=0,i=.1,r=0,l=1,c=0,h=0,u=0,d=0,f=0,p=0,b=0,g=0,y=0,m=1,k=0,M=0)=>{let v,P,x=2*Math.PI,w=e=>e>0?1:-1,S=c*=500*x/e**2,j=w(b)*x/4,T=n*=(1+2*s*Math.random()-s)*x/e,A=[],C=0,E=0,I=0,B=1,F=0,R=0,q=0;for(h*=500*x/e**3,b*=x/e,u*=x/e,d*=e,f=f*e|0,P=(o=99+o*e)+(k*=e)+(a*=e)+(i*=e)+(y*=e)|0;I<P;A[I++]=q)++R%(100*g|0)||(q=r?r>1?r>2?r>3?Math.sin((C%x)**3):Math.max(Math.min(Math.tan(C),1),-1):1-(2*C/x%2+2)%2:1-4*Math.abs(Math.round(C/x)-C/x):Math.sin(C),q=(f?1-M+M*Math.sin(2*Math.PI*I/f):1)*w(q)*Math.abs(q)**l*t*.5*(I<o?I/o:I<o+k?1-(I-o)/k*(1-m):I<o+k+a?m:I<P-y?(P-I-y)/i*m:0),q=y?q/2+(y>I?0:(I<P-y?1:(P-I)/y)*A[I-y|0]/2):q),v=(n+=c+=h)*Math.sin(E*b-j),C+=v-v*p*(1-1e9*(Math.sin(I)+1)%2),E+=v-v*p*(1-1e9*(Math.sin(I)**2+1)%2),B&&++B>d&&(n+=u,T+=u,B=0),!f||++F%f||(n=T,c=S,B=B||1);return A};function s(e,t){const s=e.audioContext||new AudioContext,n=e.sampleRate||s.sampleRate,o=e.channels||2,a=1.5*e.decay,i=Math.ceil(n*a),r=Math.ceil(n*e.fadeIn),l=Math.ceil(n*e.decay),c=Math.pow(.001,1/l),h=s.createBuffer(o,i,n);for(let e=0;e<o;++e){const t=h.getChannelData(e);for(let e=0;e<i;++e)t[e]=(Math.floor(9007199254740992*Math.random())/9007199254740991*2-1)*Math.pow(c,e);for(let e=0;e<r;++e)t[e]*=e/r}!function(e,t,s,n,o){if(!t)return void o(e);t=Math.min(t,.5*e.sampleRate),s=Math.min(s,.5*e.sampleRate);const a=function(e){const t=[];for(let s=0;s<e.numberOfChannels;++s)t[s]=e.getChannelData(s);return t}(e),i=new OfflineAudioContext(e.numberOfChannels,a[0].length,e.sampleRate),r=i.createBufferSource(),l=i.createBiquadFilter();l.type="lowpass",l.Q.value=1e-4,l.frequency.setValueAtTime(t,0),l.frequency.linearRampToValueAtTime(s,n),l.connect(i.destination),r.buffer=e,r.connect(l),r.start(),i.oncomplete=function(e){o(e.renderedBuffer)},i.startRendering()}(h,e.lpFreqStart,e.lpFreqEnd,e.decay,t)}"undefined"==typeof AudioContext&&(window.AudioContext=window.webkitAudioContext,window.OfflineAudioContext=window.webkitOfflineAudioContext);const n=120/118;let o,a,i;function r(){return o=new AudioContext,a=o.createGain(),a.gain.value=.4,function(){const e=o.createConvolver(),t=o.createGain(),i=o.createGain();return t.gain.value=2/3,i.gain.value=1/3,a.connect(e),a.connect(t),e.connect(i),t.connect(o.destination),i.connect(o.destination),new Promise((function(t){s({audioContext:o,fadeIn:1e-5,decay:1.5*n,lpFreqStart:16e3,lpFreqEnd:1e3},(function(s){e.buffer=s,t()}))}))}()}function l(e,t,s){const r=function(e){return 440*Math.pow(2,(e-69)/12)}(e);t*=n,s*=n;const l=o.createOscillator();l.type="square",l.frequency.value=r,function(e,t){const s=o.createGain();return s.gain.setValueAtTime(.5,i+t),s.gain.exponentialRampToValueAtTime(1e-5,i+t+1.5*n),e.connect(s),s}(l,t).connect(a),l.start(i+t),l.stop(i+s)}function c(e){switch(e>51?(e-8)%44+8:e){case 0:l(57,e+0,e+.25),l(45,e+0,e+2),l(60,e+.25,e+.5),l(57,e+.5,e+.75),l(64,e+.75,e+1.25);break;case 1:l(60,e+.25,e+.75),l(60,e+.75,e+1);break;case 2:l(52,e+0,e+1),l(60,e+.25,e+.5),l(57,e+.5,e+.75),l(64,e+.75,e+1.25);break;case 3:l(52,e+0,e+.75),l(60,e+.25,e+.75),l(60,e+.75,e+1),l(52,e+.75,e+1);break;case 4:l(45,e+0,e+1.75),l(57,e+.25,e+.5),l(60,e+.5,e+.75),l(64,e+.75,e+1.25),l(57,e+.75,e+1.25);break;case 5:l(57,e+.25,e+.5),l(60,e+.5,e+1),l(52,e+.75,e+1);break;case 6:l(60,e+0,e+1),l(52,e+0,e+.5),l(52,e+.5,e+1.5);break;case 7:l(64,e+0,e+1),l(52,e+.5,e+.75),l(52,e+.75,e+1);break;case 8:l(57,e+0,e+.25),l(45,e+0,e+.75),l(57,e+.25,e+.5),l(57,e+.5,e+.75),l(60,e+.75,e+1.25),l(52,e+.75,e+1.75);break;case 9:l(69,e+.25,e+.5),l(67,e+.5,e+.75),l(69,e+.75,e+1),l(52,e+.75,e+1);break;case 10:l(69,e+0,e+.75),l(41,e+0,e+.25),l(48,e+.25,e+.5),l(55,e+.5,e+1.5),l(57,e+.75,e+1.75);break;case 11:l(55,e+.5,e+.75),l(67,e+.75,e+1),l(50,e+.75,e+1);break;case 12:l(67,e+0,e+.25),l(55,e+0,e+.75),l(67,e+.25,e+.5),l(67,e+.5,e+.75),l(66,e+.75,e+1.25),l(57,e+.75,e+1.75),l(54,e+.75,e+1.75);break;case 13:l(67,e+.25,e+.5),l(66,e+.5,e+.75),l(64,e+.75,e+1),l(47,e+.75,e+1);break;case 14:l(52,e+0,e+.25),l(47,e+0,e+2),l(54,e+.25,e+.5),l(56,e+.5,e+.75),l(59,e+.75,e+1.75);break;case 15:l(57,e+.75,e+1);break;case 16:l(57,e+0,e+.25),l(45,e+0,e+.75),l(57,e+.25,e+.5),l(57,e+.5,e+.75),l(60,e+.75,e+1.25),l(52,e+.75,e+1.25);break;case 17:l(69,e+.25,e+.5),l(57,e+.25,e+1),l(67,e+.5,e+.75),l(69,e+.75,e+1);break;case 18:l(69,e+0,e+.75),l(57,e+0,e+.25),l(53,e+0,e+.25),l(48,e+0,e+.25),l(48,e+.25,e+.5),l(55,e+.5,e+.75),l(65,e+.75,e+1.75),l(57,e+.75,e+1.25);break;case 19:l(57,e+.25,e+.5),l(60,e+.5,e+1),l(67,e+.75,e+1);break;case 20:l(67,e+0,e+.25),l(43,e+0,e+.5),l(59,e+.25,e+.5),l(67,e+.5,e+.75),l(50,e+.5,e+.75),l(66,e+.75,e+1.25),l(47,e+.75,e+1.75);break;case 21:l(67,e+.25,e+.5),l(66,e+.5,e+.75),l(64,e+.75,e+1),l(47,e+.75,e+1);break;case 22:l(52,e+0,e+.25),l(47,e+0,e+2),l(54,e+.25,e+.5),l(56,e+.5,e+.75),l(59,e+.75,e+1.75);break;case 23:l(67,e+.75,e+1);break;case 24:l(67,e+0,e+.25),l(59,e+0,e+.5),l(55,e+0,e+.5),l(62,e+.25,e+.5),l(67,e+.5,e+.75),l(59,e+.5,e+.75),l(67,e+.75,e+1.25),l(57,e+.75,e+1.25);break;case 25:l(67,e+.25,e+.5),l(50,e+.25,e+.5),l(67,e+.5,e+.75),l(43,e+.5,e+1),l(68,e+.75,e+1),l(64,e+.75,e+1);break;case 26:l(68,e+0,e+.25),l(64,e+0,e+.25),l(40,e+0,e+.5),l(64,e+.25,e+.5),l(62,e+.5,e+.75),l(47,e+.5,e+.75),l(62,e+.75,e+1.25),l(52,e+.75,e+1.5);break;case 27:l(60,e+.25,e+.75),l(52,e+.5,e+.75),l(57,e+.75,e+1),l(47,e+.75,e+1);break;case 28:l(60,e+0,e+.5),l(45,e+0,e+.5),l(72,e+.5,e+1),l(64,e+.5,e+1),l(57,e+.5,e+.75),l(48,e+.75,e+1);break;case 29:l(60,e+0,e+.25),l(57,e+0,e+.75),l(53,e+0,e+.75),l(65,e+.25,e+.5),l(67,e+.5,e+.75),l(72,e+.75,e+1),l(43,e+.75,e+1);break;case 30:l(72,e+0,e+.25),l(64,e+0,e+.25),l(60,e+0,e+.25),l(48,e+0,e+.5),l(36,e+0,e+.5),l(72,e+.25,e+.5),l(64,e+.25,e+.5),l(60,e+.25,e+.5),l(72,e+.5,e+.75),l(64,e+.5,e+.75),l(60,e+.5,e+.75),l(55,e+.5,e+.75),l(72,e+.75,e+1.25),l(64,e+.75,e+1.25),l(60,e+.75,e+1.25),l(50,e+.75,e+1.5);break;case 31:l(71,e+.25,e+1),l(62,e+.25,e+1),l(59,e+.25,e+1),l(57,e+.5,e+.75),l(50,e+.75,e+1);break;case 32:l(72,e+0,e+.25),l(64,e+0,e+.25),l(60,e+0,e+.25),l(57,e+0,e+.5),l(52,e+0,e+.5),l(45,e+0,e+.5),l(72,e+.25,e+.5),l(72,e+.5,e+.75),l(59,e+.5,e+1),l(72,e+.75,e+1.25);break;case 33:l(57,e+0,e+.5),l(53,e+0,e+.5),l(48,e+0,e+.5),l(71,e+.25,e+.5),l(69,e+.5,e+.75),l(48,e+.5,e+1),l(67,e+.75,e+1),l(64,e+.75,e+1),l(60,e+.75,e+1);break;case 34:l(67,e+0,e+.25),l(64,e+0,e+.25),l(60,e+0,e+.25),l(36,e+0,e+.5),l(69,e+.25,e+.5),l(71,e+.5,e+.75),l(43,e+.5,e+.75),l(72,e+.75,e+1.25),l(68,e+.75,e+1.25),l(64,e+.75,e+1.25),l(48,e+.75,e+1);break;case 35:l(40,e+0,e+.5),l(71,e+.25,e+1),l(56,e+.5,e+.75),l(52,e+.75,e+1);break;case 36:l(60,e+0,e+.5),l(45,e+0,e+.25),l(52,e+.25,e+.5),l(72,e+.5,e+1),l(64,e+.5,e+1),l(60,e+.5,e+1),l(57,e+.5,e+1);break;case 37:l(60,e+0,e+.25),l(57,e+0,e+.5),l(53,e+0,e+.5),l(65,e+.25,e+.5),l(67,e+.5,e+.75),l(48,e+.5,e+.75),l(72,e+.75,e+1),l(60,e+.75,e+1),l(43,e+.75,e+1);break;case 38:l(72,e+0,e+.25),l(67,e+0,e+.25),l(60,e+0,e+.25),l(48,e+0,e+.5),l(72,e+.25,e+.5),l(60,e+.25,e+.5),l(72,e+.5,e+.75),l(60,e+.5,e+.75),l(55,e+.5,e+.75),l(72,e+.75,e+1.25),l(67,e+.75,e+1.25),l(62,e+.75,e+1.25),l(50,e+.75,e+1);break;case 39:l(43,e+0,e+.25),l(71,e+.25,e+.75),l(67,e+.25,e+.75),l(62,e+.25,e+.75),l(50,e+.25,e+.5),l(57,e+.5,e+1),l(59,e+.75,e+1);break;case 40:l(72,e+0,e+.5),l(64,e+0,e+.5),l(60,e+0,e+.5),l(52,e+0,e+.5),l(45,e+0,e+.5),l(72,e+.5,e+.75),l(64,e+.5,e+.75),l(60,e+.5,e+.75),l(57,e+.5,e+.75),l(72,e+.75,e+1.25),l(67,e+.75,e+1.25),l(60,e+.75,e+1.25),l(48,e+.75,e+1);break;case 41:l(57,e+0,e+.5),l(53,e+0,e+.5),l(48,e+0,e+.5),l(71,e+.25,e+.5),l(69,e+.5,e+.75),l(60,e+.5,e+.75),l(57,e+.5,e+.75),l(67,e+.75,e+1),l(53,e+.75,e+1);break;case 42:l(67,e+0,e+.25),l(48,e+0,e+.25),l(36,e+0,e+.25),l(69,e+.25,e+.5),l(43,e+.25,e+.5),l(71,e+.5,e+.75),l(48,e+.5,e+.75),l(72,e+.75,e+1.25),l(68,e+.75,e+1.25),l(64,e+.75,e+1.25),l(60,e+.75,e+1.25),l(44,e+.75,e+1);break;case 43:l(52,e+0,e+.25),l(71,e+.25,e+1),l(68,e+.25,e+1),l(64,e+.25,e+1),l(47,e+.25,e+.5),l(56,e+.5,e+.75),l(52,e+.75,e+1);break;case 44:l(72,e+0,e+.5),l(64,e+0,e+.5),l(60,e+0,e+.5),l(57,e+0,e+.25),l(45,e+0,e+.25),l(52,e+.25,e+.5),l(72,e+.5,e+.75),l(60,e+.5,e+.75),l(57,e+.5,e+.75),l(72,e+.75,e+1.25),l(67,e+.75,e+1.25),l(60,e+.75,e+1.25),l(48,e+.75,e+1);break;case 45:l(57,e+0,e+.25),l(53,e+0,e+.25),l(71,e+.25,e+.5),l(55,e+.25,e+.5),l(69,e+.5,e+.75),l(48,e+.5,e+1),l(67,e+.75,e+1),l(64,e+.75,e+1),l(60,e+.75,e+1);break;case 46:l(67,e+0,e+.25),l(64,e+0,e+.25),l(60,e+0,e+.25),l(48,e+0,e+.25),l(36,e+0,e+.25),l(69,e+.25,e+.5),l(43,e+.25,e+.5),l(71,e+.5,e+.75),l(48,e+.5,e+1),l(72,e+.75,e+1.25),l(68,e+.75,e+1.25),l(60,e+.75,e+1.25);break;case 47:l(52,e+0,e+.5),l(40,e+0,e+.5),l(71,e+.25,e+1),l(68,e+.25,e+1),l(62,e+.25,e+1),l(47,e+.5,e+.75),l(52,e+.75,e+1);break;case 48:l(71,e+0,e+2),l(68,e+0,e+2),l(62,e+0,e+2),l(52,e+0,e+.25),l(54,e+.25,e+.75),l(56,e+.75,e+1.25);break;case 49:l(54,e+.25,e+.5),l(56,e+.5,e+1);break;case 50:l(64,e+0,e+1.75);break;case 51:l(52,e+.75,e+1)}}let h=-1;function u(){let e=o.currentTime-i+4,t=(h+1)*n;if(!(t>e))for(e+=4;t<e;)c(++h),t+=n}function d(){i=o.currentTime+.05,u(),setInterval(u,999)}const f=function(){let e,t;const s=.02;let n=-1,o=0;function a(i){requestAnimationFrame(a),-1===n&&(n=i),o+=.001*(i-n),n=i;let r=2;for(;o>0;)o-=s,r>0&&(e(s),--r);t(o/s+1)}return function(s,n){e=s,t=n,requestAnimationFrame(a)}}();class p{constructor(e=0,t=0){this.x=e,this.y=t}set(e,t){this.x=e,this.y=t}copy(e){this.x=e.x,this.y=e.y}length(){return(this.x**2+this.y**2)**.5}add(e){this.x+=e.x,this.y+=e.y}subtract(e){this.x-=e.x,this.y-=e.y}setSubtract(e,t){this.x=e.x-t.x,this.y=e.y-t.y}scale(e){this.x*=e,this.y*=e}setMultiplyScalar(e,t){this.x=e.x*t,this.y=e.y*t}dot(e){return this.x*e.x+this.y*e.y}distanceSquared(e,t){const s=this.x-e,n=this.y-t;return s*s+n*n}}const b=function(){const e=1/6,t=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function s(e){this.p=function(e){const t=new Uint8Array(256);for(let e=0;e<256;++e)t[e]=e;for(let s=0;s<255;++s){const n=s+e.random()*(256-s)|0,o=t[s];t[s]=t[n],t[n]=o}return t}(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;++e)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}return s.prototype.noise3D=function(s,n,o){const a=this.permMod12,i=this.perm;let r,l,c,h;const u=.3333333333333333*(s+n+o),d=Math.floor(s+u),f=Math.floor(n+u),p=Math.floor(o+u),b=(d+f+p)*e,g=s-(d-b),y=n-(f-b),m=o-(p-b);let k,M,v,P,x,w;g>=y?y>=m?(k=1,M=0,v=0,P=1,x=1,w=0):g>=m?(k=1,M=0,v=0,P=1,x=0,w=1):(k=0,M=0,v=1,P=1,x=0,w=1):y<m?(k=0,M=0,v=1,P=0,x=1,w=1):g<m?(k=0,M=1,v=0,P=0,x=1,w=1):(k=0,M=1,v=0,P=1,x=1,w=0);const S=g-k+e,j=y-M+e,T=m-v+e,A=g-P+2*e,C=y-x+2*e,E=m-w+2*e,I=g-1+.5,B=y-1+.5,F=m-1+.5,R=255&d,q=255&f,D=255&p;let J=.6-g*g-y*y-m*m;if(J<0)r=0;else{const e=3*a[R+i[q+i[D]]];J*=J,r=J*J*(t[e]*g+t[e+1]*y+t[e+2]*m)}let _=.6-S*S-j*j-T*T;if(_<0)l=0;else{const e=3*a[R+k+i[q+M+i[D+v]]];_*=_,l=_*_*(t[e]*S+t[e+1]*j+t[e+2]*T)}let z=.6-A*A-C*C-E*E;if(z<0)c=0;else{const e=3*a[R+P+i[q+x+i[D+w]]];z*=z,c=z*z*(t[e]*A+t[e+1]*C+t[e+2]*E)}let W=.6-I*I-B*B-F*F;if(W<0)h=0;else{const e=3*a[R+1+i[q+1+i[D+1]]];W*=W,h=W*W*(t[e]*I+t[e+1]*B+t[e+2]*F)}return 32*(r+l+c+h)},s}(),g="#000000",y="#8CFF9B",m="#FFE091",k="#78FAE6",M=[[0,0],[0,1],[0,2],[1,0],[1,1],[1,2],[0,3],[1,3]];function v(e,t,s,n,o){for(let a=0;a<8;++a){if(!0&o){const o=t+6*M[a][0],i=s+6*M[a][1];e.rect(o,i,n,n)}o>>>=1}}const P=240;const x=12,w=3e3,S=190,j=5e3,T=16,A=.1*Math.PI,C=(Math.PI,96),E=1200,I=1200,B=2*Math.PI,F={a:document.getElementById("a"),b:document.getElementById("b")},R={a:F.a.getContext("2d"),b:F.b.getContext("2d")};F.a.height=F.b.height=E,F.a.width=F.b.width=I,R.a.miterLimit=1;const q=document.getElementById("fun"),D=document.getElementById("doge").firstChild;function J(e,t,s){return e*(1-s)+t*s}function _(e){if(Me.entered.has(e))return;Me.entered.add(e);const t=document.getElementById("fn-"+e);"fn enter"!==t.className&&(t.className="fn enter")}function z(e){const t=document.getElementById("fn-"+e);"fn"!==t.className&&(t.className="fn")}function W(e,t){t&&"upgrade"===e&&(t=0!==Me.defenses.filter((e=>e.job===he&&e.level<4)).length);const s=t?"":"off",n=document.getElementById("btn-"+e);n.className!==s&&(n.className=s)}function N(e,t){document.getElementById("c-"+e).firstChild.textContent=""+t}function G(e){if(Me.entered.has("."+e))return;Me.entered.add("."+e);const t=document.getElementById("nt-"+e);"nt enter"!==t.className&&(clearTimeout(Me.toClearHeadline),H(),t.className="nt enter",Me.toClearHeadline=setTimeout(H,9e3),0===e.indexOf("decay")?$(X):$(K))}function H(){const e=document.getElementsByClassName("nt");for(let t=0;t<e.length;++t)"nt"!==e[t].className&&(e[t].className="nt")}function L(e){Me.ended=!0;document.getElementById("nu").style.display="none";const t=document.getElementById("end-"+e);t.firstChild.textContent="b"===e?`Under your glorious leadership, a small amount of ${Me.spent} billion Dogecoins were well spent on annihilating a group of ${Me.kills} alien space vessels. This might not have been entirely necessary, but a victory is a victory.\n\nWritten by Mark Vasilkov for js13kGames in 2021.`:"Contacting the highly advanced aliens ushered humanity into a golden age of technology, which lasted until the onset of the Age of Strife in the 25th Millennium. But that's a completely different story.\n\nWritten by Mark Vasilkov for js13kGames in 2021.",t.style.display="block",setTimeout((()=>{document.getElementById("end").className="enter",$(Y)}),100)}function O(){}function V(e,t,s){return e<t?s:e>=s?-s:0}function U(e){return e<-Math.PI?B:e>=Math.PI?-B:0}function $(t){if(Me.optSound)try{null===t.buf&&(t.buf=o.createBuffer(1,t.raw.length,e),t.buf.getChannelData(0).set(t.raw));const s=o.createBufferSource();s.buffer=t.buf,s.connect(o.destination),s.start()}catch(e){}}const Q={raw:t.apply(null,[,,417,,.01,.01,,.94,-.1,2.5,-9,,,,,,,,.07,.01]),buf:null},K={raw:t.apply(null,[,,345,.01,.17,.87,1,1.05,.2,,67,.03,.02,,-.2,,,.79,,.04]),buf:null},X={raw:t.apply(null,[,,382,,,.48,2,.35,-.6,,,,,,,,.2,.72,.09]),buf:null},Y={raw:t.apply(null,[1.65,,348,.09,.37,.29,2,1.3,4,-5.5,182,.1,.1,.1,,,.13,.88,.04,.28]),buf:null};let Z=!1;function ee(){try{r().then(d)}catch(e){}Z=!0}const te=()=>55*Math.random()+200;class se{constructor(){this.color=`rgb(${te()},${te()},${te()})`,this.power=5*Math.random(),this.pos=new p(I*Math.random(),E*Math.random())}}function ne(e,t){e.beginPath(),e.arc(.5*I,.5*E,t+20,0,B),e.closePath(),e.fillStyle=g,e.fill()}const oe=function(){const e=e=>(8&e)<<3|(112&e)>>1|135&e,t=(e,t)=>Array.from(Array(1+(t>>2)),(()=>new Uint8Array(1+(e>>1)))),s=(e,t,s)=>e[s>>2][t>>1]|=1<<(3&s|(1&t)<<2),n=(e,t,s)=>{let n=0;for(let o=e;o--;t>>=1,s>>=1)n=(1&t^1&s|n<<1)<<1|1&s;return n};return function(o,a,i){const r=new b(o),l=(e=>{const t=1<<e,s=t*t,o=new Float32Array(s);for(let a=0;a<t;++a)for(let i=0;i<t;++i)o[i+a*t]=(n(e,i,a)+.5)/s;return(e,s)=>o[e%t+s%t*t]})(4),c=(e,t,s)=>{return 2*(.5+.5*(n=.5,o=1,a=e,i=t,l=s,r.noise3D(a*(n*=2),i*n,l*n)*(o*=.5)+r.noise3D(a*(n*=2),i*n,l*n)*(o*=.5)+r.noise3D(a*(n*=2),i*n,l*n)*(o*=.5)+r.noise3D(a*(n*=2),i*n,l*n)*(o*=.5)+r.noise3D(a*(n*=2),i*n,l*n)*(o*=.5)+r.noise3D(a*(n*=2),i*n,l*n)*(.5*o)))%1;var n,o,a,i,l},h=(e,t,s,n,o)=>{const a=s*s+n*n;if(a>1)return!1;const i=1/((1-a**.5)**.5+1);return c(.1*o+i*s,i*n,.01*o)>l(e,t)};let u=t(a,i);this.resize=function(e,s){e===a&&s===i||(u=t(a=e,i=s))},this.render=function(){const e=9e-4*Date.now();for(let e=0;e<u.length;++e){const t=u[e];for(let e=0;e<t.length;++e)t[e]=0}for(let t=0;t<i;++t){const n=2*t/i-1;for(let o=0;o<a;++o){h(o,t,2*o/a-1,n,e)&&s(u,o,t)}}return u},this.enc=e}}(),ae=10;class ie{constructor(e,t){this.pl=e,this.n=t,this.x=0,this.y=0,this._changeJob(0)}_changeJob(e){this.job=e,this.progress=0,this.lastProgress=0}attack(e,t){this.pl.updateCannonsRelativeToRotation(O),e.initialize(this,t),this._changeJob(2)}render(e){e.save(),e.translate(this.x,this.y),e.rotate(Math.atan2(this.y,this.x)),e.moveTo(0,ae),e.arc(0,0,ae,.5*Math.PI,1.5*Math.PI),e.lineTo(25,-6),e.lineTo(25,6),e.closePath(),e.restore()}render2(e,t){const s=35*t,n=s-ae;if(e.save(),e.translate(this.x,this.y),e.rotate(Math.atan2(this.y,this.x)),s<=ae){const t=Math.acos(n/ae),s=ae*Math.sin(t);e.moveTo(n,s),e.arc(0,0,ae,t,B-t)}else{const s=J(1,.6,t=n/25)*ae;e.moveTo(0,ae),e.arc(0,0,ae,.5*Math.PI,1.5*Math.PI),e.lineTo(n,-s),e.lineTo(n,s)}e.closePath(),e.restore()}}const re=Array(48),le=Array(48);const ce=2,he=3,ue=B/x;class de{constructor(e){this.cannons=Array(4),this.n=e,this._changeJob(0,0)}_changeJob(e,t){this.job=e,this.progress=0,this.lastProgress=0,this.level=t}build(){this._changeJob(1,0)}upgrade(){this._changeJob(ce,this.level)}updateCannonsRelativeToRotation(e){const t=this.job===ce?2*this.level:this.level,s=.064*t+.14,n=ue*(this.n-s),o=ue*(this.n+s),a=372.2,i=a*Math.cos(n),r=a*Math.sin(n),l=a*Math.cos(o),c=a*Math.sin(o);for(let s=0;s<this.level;++s){const n=(s+1)/(t+1),o=this.cannons[s];o.x=J(i,l,n),o.y=J(r,c,n),e(o)}}update(){switch(this.job){case 1:this.lastProgress=this.progress,100===this.progress?(this._changeJob(he,1),this.cannons[this.level-1]._changeJob(2),2===Me.defenses.filter((e=>e.job===he)).length&&(_("upgrade"),document.monetization&&"started"===document.monetization.state&&_("bonus")),W("upgrade",Me.funds>=Me.costs.upgrade)):++this.progress;break;case ce:this.lastProgress=this.progress,150===this.progress?(this._changeJob(he,2*this.level),this.cannons[this.level-1]._changeJob(2),4===this.level?this.cannons[2]._changeJob(2):(_("speed"),W("upgrade",Me.funds>=Me.costs.upgrade))):++this.progress;break;case 4:this.lastProgress=this.progress,200===this.progress?(this._changeJob(0,0),0===Me.toBadEnding&&(Me.toBadEnding=setTimeout((()=>{L("b")}),600))):++this.progress}}getSizeLevel(){return this.job===ce?2*this.level:1===this.job?1:this.level}render(e,t){const s=.064*this.getSizeLevel()+.1,n=ue*(this.n-s),o=ue*(this.n+s),a=350,i=380,r=Math.cos(n),l=Math.cos(o),c=Math.sin(n),h=Math.sin(o),u=a*r,d=a*c,f=i*r,p=i*c;e.moveTo(u,d),e.lineTo(f,p),e.lineTo(J(f,i*l,t),J(p,i*h,t)),e.lineTo(J(u,a*l,t),J(d,a*h,t)),e.closePath()}}class fe{constructor(){this.job=0,this.pos=new p,this.lastPos=new p,this.angle=0,this.lastAngle=0,this.targeted=!1}initialize(){const e=Math.random()<.5,t=I*Math.random();this.job=1,this.pos.set(e?t:0,e?0:t),this.lastPos.copy(this.pos),this.angle=this.lastAngle=B*Math.random()-Math.PI,this.targeted=!1}update(){if(this.lastPos.copy(this.pos),this.lastAngle=this.angle,Me.phase!==ke&&this.pos.distanceSquared(.5*I,.5*I)<2e5){const e=Math.atan2(this.pos.y-.5*E,this.pos.x-.5*I);let t=this.angle-e;t+=U(t),this.angle+=t>0?-A:A}else this.angle+=A*(Math.random()-.5);if(pe(this,6),Me.phase===me&&(this.pos.x<1||this.pos.y<1||this.pos.x>I-2||this.pos.y>E-2)&&(this.job=0,this.targeted)){const e=Me.rockets.find((e=>e.target===this));void 0!==e&&(e.job=be)}}render(e,t){e.save(),e.translate(J(this.lastPos.x,this.pos.x,t),J(this.lastPos.y,this.pos.y,t)),e.rotate(J(this.lastAngle,this.angle,t)),e.moveTo(-8,0),e.lineTo(-12,-15),e.lineTo(20,0),e.lineTo(-12,15),e.closePath(),e.restore()}}function pe(e,t){e.pos.x+=t*Math.cos(e.angle),e.pos.y+=t*Math.sin(e.angle);const s=V(e.pos.x,0,I),n=V(e.pos.y,0,E),o=U(e.angle);e.pos.x+=s,e.lastPos.x+=s,e.pos.y+=n,e.lastPos.y+=n,e.angle+=o,e.lastAngle+=o}const be=0;class ge{constructor(){this.job=be,this.pos=new p,this.lastPos=new p,this.angle=0,this.lastAngle=0,this.target=null}initialize(e,t){this.job=1,t.targeted=!0;const s=B*Me.rotation/w,n=Math.cos(s),o=Math.sin(s),a=1.09*(n*e.x-o*e.y)+.5*I,i=1.09*(n*e.y+o*e.x)+.5*I;this.pos.set(a,i),this.lastPos.set(a,i),this.angle=this.lastAngle=s+Math.atan2(e.y,e.x),this.target=t}update(){this.lastPos.copy(this.pos),this.lastAngle=this.angle;let e,t=this.target.pos.x,s=this.target.pos.y,n=t,o=s,a=this.pos.distanceSquared(t,s);if((e=this.pos.distanceSquared(t+I,s))<a&&(a=e,n=t+I,o=s),(e=this.pos.distanceSquared(t-I,s))<a&&(a=e,n=t-I,o=s),(e=this.pos.distanceSquared(t,s+E))<a&&(a=e,n=t,o=s+E),(e=this.pos.distanceSquared(t,s-E))<a&&(a=e,n=t,o=s-E),a<Me.rocketSpeed**2)return void function(e){e.job=be;let t=0;for(let s=0;s<C;++s){const n=Me.debris[s];if(0===n.job&&(n.initialize(e.target.pos.x,e.target.pos.y),6==++t))break}(Me.funds+=Me.revenuePerHit)>200&&z("bonus");Pe(),24==++Me.kills?G("loss"):800===Me.kills&&G("loss2");e.target.initialize()}(this);const i=Math.atan2(o-this.pos.y,n-this.pos.x);let r=this.angle-i;r+=U(r),this.angle+=r>0?-A:A,pe(this,Me.rocketSpeed)}render(e,t){const s=J(this.lastPos.x,this.pos.x,t),n=J(this.lastPos.y,this.pos.y,t);e.rect(s-5,n-5,10,10)}}class ye{constructor(){this.job=0,this.pos=new p,this.lastPos=new p,this.angle=0,this.lastAngle=0,this.life=0}initialize(e,t){this.job=1,this.pos.set(e,t),this.lastPos.copy(this.pos),this.angle=this.lastAngle=B*Math.random()-Math.PI,this.life=50}update(){this.lastPos.copy(this.pos),0!=--this.life?pe(this,5):this.job=0}}const me=4,ke=5,Me={};function ve(e){if(Me.phase===e-1||2===Me.phase&&e===ke)switch(Me.phase=e){case 1:case 3:Me.progress=Me.lastProgress=0;break;case 2:q.style.opacity="1",setTimeout((()=>{G("first")}),250),setTimeout((()=>{_("attack"),_("build")}),500),Me.toGoodEnding=setTimeout((()=>{_("peace"),Me.toGoodEnding=0}),6e4),Me.planet.resize(90,90);for(let e=0;e<T;++e)Me.invaders[e].initialize();break;case ke:setTimeout((()=>{G("end")}),600),setTimeout((()=>{L("g")}),6e3),z("attack"),z("build");break;case me:z("build"),z("upgrade"),z("bonus"),z("speed"),z("reload"),z("ubi1"),z("ubi2"),z("ubi3"),_("strip")}}function Pe(){if(Me.entered.has("speed"))switch(!0){case Me.funds>=125:_("reload");case Me.funds>=44:_("ubi1");case Me.funds>=24:_("auto1")}}const xe={start(){z("start"),ve(1)},attack(e){if(0===(e=Me.cannons.filter((e=>1===e.job))).length)return 0;0===Me.kills&&z("peace");const t=Me.rockets.find((e=>e.job===be)),s=Me.invaders.find((e=>1===e.job&&!e.targeted));return void 0!==t&&void 0!==s&&e[e.length*Math.random()|0].attack(t,s),e.length},build(e){0!==Me.toGoodEnding&&(clearTimeout(Me.toGoodEnding),Me.toGoodEnding=0),0!==(e=Me.defenses.filter((e=>0===e.job))).length&&(1===e.length?(G("plat"),z("build")):11===e.length&&G("build"),N("build",Me.costs.build*=2),e[e.length*Math.random()|0].build())},upgrade(e){const t=(e=Me.defenses.filter((e=>e.job===he))).filter((e=>1===e.level)),s=e.filter((e=>2===e.level));if(0!==t.length)e=t;else{if(0===s.length)return;e=s}1===Me.defenses.filter((e=>!(e.job===he&&4===e.level||e.job===ce&&2===e.level))).length?(G("upg"),z("upgrade")):N("upgrade",Me.costs.upgrade*=2),e[e.length*Math.random()|0].upgrade()},bonus(){z("bonus"),Pe()},speed(){Me.rocketSpeed*=1.2,z("speed")},reload(){Me.reloadTime*=.8;for(let e=0;e<Me.cannons.length;++e){const t=Me.cannons[e];2===t.job&&t.progress>Me.reloadTime&&(t.progress=t.lastProgress=Me.reloadTime)}z("reload")},auto1(){Me.afEnabled=!0,G("spend"),z("auto1"),_("auto2")},auto2(){Me.afTicks*=.5,G("spend2"),z("auto2"),_("auto3")},auto3(){Me.afTicks*=.5,G("ai"),z("auto3"),setTimeout((()=>{G("decay"),ve(3)}),2e4)},ubi1(){Me.revenuePerHit*=2,G("eco"),z("ubi1"),_("ubi2")},ubi2(){Me.revenuePerHit*=2,G("eco2"),z("ubi2"),_("ubi3")},ubi3(){Me.revenuePerHit*=2,z("ubi3")},strip(){!function(e){for(let t=0;t<x;++t){const s=e[t];if(0!==s.job){s._changeJob(4,s.getSizeLevel());for(let e=0;e<s.level;++e)s.cannons[e]._changeJob(0)}}}(Me.defenses),z("attack"),z("strip")},peace(){z("peace"),ve(ke)},music(){document.getElementById("btn-music").firstChild.textContent="music "+((Me.optMusic=!Me.optMusic)?"on":"off"),a.gain.value=Me.optMusic?.4:0},sound(){document.getElementById("btn-sound").firstChild.textContent="sound "+((Me.optSound=!Me.optSound)?"on":"off")}};function we(){!0!==Me.ended&&(function(){if(Me.funds!==Me.lastFunds){D.textContent=""+(Me.lastFunds=Me.funds);for(let e in Me.costs)W(e,Me.funds>=Me.costs[e])}if(1===Me.phase)Me.lastProgress=Me.progress,120===Me.progress?ve(2):++Me.progress;else if(3===Me.phase)if(Me.lastProgress=Me.progress,Me.progress===j)Me.planetColor="#FF695A",ve(me);else{++Me.progress;const e=Me.progress/j;e>.75?(G("decay4"),Me.planetColor="#FFAA6E"):e>.5?(G("decay3"),Me.planetColor=m):e>.25&&(G("decay2"),Me.planetColor="#C1D9F2")}}(),function(e){Me.lastRotation=Me.rotation,++Me.rotation===w&&(Me.rotation=0);for(let t=0;t<x;++t)e[t].update()}(Me.defenses),function(e){let t=0;for(let s=0;s<48;++s){const n=e[s];1===n.job?++t:2===n.job&&(n.lastProgress=n.progress,n.progress>=Me.reloadTime?(n._changeJob(1),++t):++n.progress)}Me.afEnabled&&Me.phase!==me&&(Me.afProgress>=Me.afTicks?-1!=(t=xe.attack()-1)&&(Me.afProgress=1):++Me.afProgress),W("attack",t>0&&Me.phase!==me)}(Me.cannons),function(e){for(let t=0;t<T;++t)1===e[t].job&&e[t].update()}(Me.invaders),function(e){for(let t=0;t<16;++t)1===e[t].job&&e[t].update()}(Me.rockets),function(e){for(let t=0;t<C;++t)1===e[t].job&&e[t].update()}(Me.debris))}function Se(e){if(!0===Me.ended)return;R.a.clearRect(0,0,I,I);let t=.5*I-3*(0===Me.phase?S:90);if(0===Me.phase)ne(R.a,570);else if(1===Me.phase){const s=J(Me.lastProgress,Me.progress,e),n=J(S,90,function(e){return e*(2-e)}(s/120));Me.planet.resize(n,n),t=.5*I-3*n&4094,ne(R.a,3*n)}!function(e,t,s,n,o,a){e.beginPath();for(let n=0;n<o.length;++n){const i=o[n];for(let o=0;o<i.length;++o){const r=a(i[o]);0!==r&&v(e,t+12*o,s+24*n,6,r)}}e.fillStyle=n,e.fill()}(R.a,t,t,Me.planetColor,Me.planet.render(),Me.planet.enc),3===Me.phase&&function(e,t,s){const n=.5*I-120,o=.5*E-12;e.fillStyle=g,e.lineWidth=6,e.strokeStyle=t,e.fillRect(n-18,o-18,276,60),e.strokeRect(n-9,o-9,258,42),e.fillStyle=t,e.fillRect(n,o,P*(j-s)/j,24)}(R.a,Me.planetColor,Me.progress),function(e,t,s){const n=J(Me.lastRotation,Me.rotation+(Me.rotation<Me.lastRotation?w:0),s);t.save(),t.translate(.5*I,.5*I),t.rotate(B*n/w),t.beginPath();for(let s=0;s<x;++s){const n=e[s];n.job===he&&n.render(t,1)}t.fillStyle=y,t.fill(),t.lineWidth=8,t.strokeStyle=g,t.stroke(),t.lineWidth=4,t.strokeStyle=y,t.stroke(),t.beginPath();for(let n=0;n<x;++n){const o=e[n];if(1===o.job||o.job===ce||4===o.job){const e=J(o.lastProgress,o.progress,s);o.render(t,(4===o.job?200-e:e)/(1===o.job?100:o.job===ce?150:200))}}t.fillStyle=m,t.fill(),t.beginPath();for(let s=0;s<x;++s){const n=e[s];1!==n.job&&n.job!==ce&&4!==n.job||n.render(t,1)}t.lineWidth=8,t.strokeStyle=g,t.stroke(),t.lineWidth=4,t.strokeStyle=y,t.stroke()}(Me.defenses,R.a,e),function(e,t,s){let n=0,o=0;for(let t=0;t<x;++t){const s=e[t];s.job!==ce&&s.job!==he||s.updateCannonsRelativeToRotation((e=>{1===e.job?re[n++]=e:le[o++]=e}))}t.beginPath();for(let e=0;e<n;++e)re[e].render(t);t.fillStyle=k,t.fill(),t.lineWidth=8,t.strokeStyle=g,t.stroke(),t.lineWidth=4,t.strokeStyle=k,t.stroke(),t.beginPath();for(let e=0;e<o;++e)le[e].render(t);t.fillStyle=g,t.fill(),t.beginPath();for(let e=0;e<o;++e){const n=le[e];n.render2(t,J(n.lastProgress,n.progress,s)/Me.reloadTime)}t.lineWidth=4,t.strokeStyle=g,t.stroke(),t.fillStyle=m,t.fill(),t.beginPath();for(let e=0;e<o;++e)le[e].render(t);t.lineWidth=8,t.strokeStyle=g,t.stroke(),t.lineWidth=4,t.strokeStyle=k,t.stroke(),t.restore()}(Me.defenses,R.a,e),function(e,t,s){t.beginPath();for(let n=0;n<T;++n)1===e[n].job&&e[n].render(t,s);if(Me.phase===ke)return t.lineWidth=8,t.strokeStyle=g,t.stroke(),t.lineWidth=4,t.strokeStyle=y,void t.stroke();t.lineWidth=4,t.strokeStyle="#FFA5D5",t.stroke()}(Me.invaders,R.a,e),function(e,t,s){t.beginPath();for(let n=0;n<16;++n)1===e[n].job&&e[n].render(t,s);t.fillStyle=k,t.fill()}(Me.rockets,R.a,e),function(e,t,s){t.beginPath();for(let n=0;n<C;++n){const o=e[n];if(1===o.job){const e=J(o.lastPos.x,o.pos.x,s),n=J(o.lastPos.y,o.pos.y,s),a=o.life/50*6+4;t.rect(e,n,a,a)}}t.fillStyle=m,t.fill()}(Me.debris,R.a,e)}W("music",!1),W("sound",!1),document.body.addEventListener("contextmenu",(e=>{e.preventDefault()})),function(){for(let e in xe)document.getElementById("btn-"+e).addEventListener("click",(function(t){t.preventDefault(),"start"===e?(ee(),W("music",!0),W("sound",!0)):"attack"!==e&&"music"!==e&&"sound"!==e&&$(Q);const s=Me.costs[e];if("number"==typeof s){if(!(Me.funds>=s))return;Me.funds-=Me.costs[e],Me.spent+=Me.costs[e]}xe[e]()}));document.addEventListener("keydown",(function(e){" "!==e.key&&"Space"!==e.code&&32!==e.keyCode||(e.preventDefault(),e.repeat||!Me.entered.has("attack"))||""===document.getElementById("btn-attack").className&&xe.attack()}))}(),function(){Me.phase=0,Me.progress=Me.lastProgress=0,Me.funds=Me.lastFunds=2,Me.spent=0,Me.kills=0,Me.entered=new Set,Me.costs={build:2,upgrade:8,bonus:-200,speed:25,reload:250,auto1:48,auto2:300,auto3:500,ubi1:100,ubi2:666,ubi3:900,peace:2},Me.stars=Array(150);for(let e=0;e<150;++e)Me.stars[e]=new se;Me.planet=new oe(Math,S,S),Me.planetColor=k,Me.defenses=Array(x),Me.cannons=Array(48);for(let e=0;e<x;++e){const t=new de(e);for(let s=0;s<4;++s){const n=new ie(t,s);t.cannons[s]=Me.cannons[4*e+s]=n}Me.defenses[e]=t}Me.rotation=Me.lastRotation=0,Me.invaders=Array(T);for(let e=0;e<T;++e)Me.invaders[e]=new fe;Me.rockets=Array(16);for(let e=0;e<16;++e)Me.rockets[e]=new ge;Me.debris=Array(C);for(let e=0;e<C;++e)Me.debris[e]=new ye;Me.toClearHeadline=Me.toGoodEnding=Me.toBadEnding=0,Me.optMusic=!0,Me.optSound=!0,Me.rocketSpeed=9,Me.reloadTime=50,Me.revenuePerHit=1,Me.afEnabled=!1,Me.afTicks=12,Me.afProgress=0,Me.ended=!1}(),function(e,t){e.fillStyle=g,e.fillRect(0,0,I,E);for(let s of t)e.fillStyle=s.color,e.fillRect(s.pos.x,s.pos.y,s.power,s.power)}(R.b,Me.stars),ne(R.b,270),f(we,Se)}();